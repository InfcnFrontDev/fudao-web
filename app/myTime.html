<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/global.css">

  <script type="text/javascript" src="js/jquery.min.js"></script>
 <!-- <script src="js/renti-map.js"></script>-->
  <script type="text/javascript" src="js/source/calendar.js"></script>
  <!--<script src="js/svg-pan-zoom.js"></script>-->
  <script src="js/hammer.js"></script>
  <link rel="stylesheet" href="css/all.css">
  <script src="js/data.js"></script>
 <!-- <script src="venders/renti_map/app/js/tools.js"></script>-->

  <script>
    (function () {
      'use strict';

      var RentiMap = function (element, options) {

        var $popover = $('<div class="popover-box popover-hide"><div class="popover" transition="modal"><img src="images/zhishi.png" class="zhishi"><div class="popover-content"></div></div></div>');

        $(element).after($popover);

        var data = options.data;

        var jl_maps = data.jl_map.split(',');
        showJlInfo(data);

        $(element).empty();
        $(element).load('venders/renti_map/app/svg/' + jl_maps[0] + '.svg', function () {
          var $svg = $("#svg");
          $svg.attr('style', 'display: inline; width: inherit; min-width: inherit; max-width: inherit; height: inherit; min-height: inherit; max-height: inherit;');

          var $jingluo = $('#jingluo');
          $jingluo.children().hide();


          $(data.jl_id.split(',')).each(function () {

            $jingluo.find('#'+ this+'').show();
            $jingluo.find('#'+ this+'').on('click',function(){
              showJlInfo(data);
            })
            //console.log($jingluo.find('#'+ this+''));
          });

          // Expose to window namespace for testing purposes
         /* var panZoom = svgPanZoom("#svg", {
            zoomEnabled: true,
            panEnabled: true,
            controlIconsEnabled: false,
            zoomScaleSensitivity: 0.5,
            minZoom: 0,
            maxZoom: 50,
            fit: 1,
            center: 1
          });*/


        });



        function showJlInfo(data) {

          var title = "<strong>健康提醒：</strong>" + data.tixing;
          var content = "<p><strong>循行筋络：</strong>" + data.jl_name + "</p>";
          content += "<p><strong>当令器官：</strong>" + data.qiguan + "</p>";
          content += "<p><strong>身体状况：</strong>" + data.zhuangkuang + "</p>";
          content += "<p><strong>常见症状：</strong>" + data.zhengzhuang + "</p>";
          content += "<p><strong>宜：</strong>" + data.yi + "</p>";
          content += "<p><strong>忌：</strong>" + data.ji + "</p>";
          content += "<p><strong>养生方法：</strong>" + data.yangsheng + "</p>";
          content += "<p><strong>健康小贴士：</strong>" + data.laonianren + "</p>";
          showPopover( content);
        }

        function showPopover( content) {
          //$popover.find('.popover-title').html(title);
          //$popover.find('.popover-title').html(title);
          $popover.find('.popover-content').html(content);
          $popover.removeClass('popover-hide').addClass('popover-show');
          //$popover.removeClass('popover-hide').addClass('popover-show');

        }

        function hidePopover() {
          $popover.removeClass('popover-show').addClass('popover-hide');
        }

        function clickPopover() {
          var ele = event.srcElement || event.target;

          if ($(ele).parents('.popover').length == 0) {
            hidePopover();
          }
        }

        $popover.on("click", clickPopover);
      };

      window.RentiMap = RentiMap;

    })();
    window.onload=function(){
      var item = getItem(new Date());
      //console.log(item);
      new RentiMap("#mapDiv", {
        data: item
      });
      function getItem(date) {
        var h = date.getHours(), m = date.getMinutes();
        var num = parseInt(((h + 1) * 60 + m) / 120);
        if (num == 12) num = 0;
        return sheets.shiershichen[num];
      }

    }
  </script>
</head>
<body>
  <div class="topBox">
    <div style="width:70%; height:100%;float:left;">
      <div>
        <span id="ymd" class="mg-left-8"></span>
        <span id="div_hour" class="mg-left-4"></span>
        <span id="week" class=" mg-left-4"></span>
      </div>

      <div>
        <span id="ymd_yinli" class="mg-left-8"></span>
        <span id="lunar" class="mg-left-8"></span>
        <span id="lunarHour" class="mg-left-8"></span>
      </div>
    </div>

    <div style="width:30%; height:100%;float:right;">
      <div style="width:100%; float:right;height:40px;">
        <div style="width:40%; height:100%; float:left;">
          <img src="" style="width:100%;height:100%; margin-top:6px;" alt="" id="weatherImg">
        </div>
        <div style="width:60%; float:left;">
          <div id="jieqi"></div>
          <div class="wendu">1-5</div>
        </div>
      </div>
    </div>

  </div>
  <div class="centerBox">
    <div id="mapDiv" style="width: 100%; height: 100%">
  </div>
  </div>
  <div class="bottomBox">
    <div style="width:70%; float:left;border-right:1px solid #d8d8d8;">
      <div class="mg-left-8">
        <span id="festival"></span>
        <span id="days"></span>
      </div>
      <div class="mg-left-8">上一节气：<span id="upJieQi"></span></div>
      <div class="mg-left-8">下一节气：<span id="nextJieQi"></span></div>
    </div>

    <div style="width:28%; float:right; text-align:center;  line-height: 80px;">清明节</div>
  </div>
  <script>
      fun_time();
      fun_getUpAndNextJieQi();
      window.setInterval("fun_time()", 1000);

      $('#jieqi').html($('#upJieQi').text().split('(')[0])
      var url='http://192.168.3.126:18080/fudao-svc/app/weatherAction!getWeather.action?city=北京市';
      $.ajax({
        dataType: "json",
        url: url,
        success: function(data){
          console.log(data);
          var dataobj=data.result;
          console.log(dataobj);
          $('.wendu').html(dataobj.temperature);
          var num=parseInt(dataobj.weatid)-1;
          $('#weatherImg').attr('src','images/weather/d1/'+num+'.png')

        }
      });

  </script>

</body>
</html>